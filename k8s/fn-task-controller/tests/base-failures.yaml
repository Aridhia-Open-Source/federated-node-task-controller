suite: Failing test cases for microk8s
release:
  namespace: federatednode
  name: federatednode
values:
  - values/base-values.yaml
set:
  storage:
    local:
      path: /data/controller
kubernetesProvider:
  scheme:
    v1/Secret:
      gvr:
        version: v1
        resource: secrets
      namespaced: true
    v1/ConfigMap:
      gvr:
        version: v1
        resource: configmaps
      namespaced: true
  objects:
    - apiVersion: v1
      kind: ConfigMap
      metadata:
        name: keycloak-config
        namespace: federatednode
      data:
        KEYCLOAK_ADMIN: admin
        KC_DB_URL_HOST: testhost.com
        KC_DB_USERNAME: admin_user
tests:
  - it: missing gh secret causes a failure
    template: copy-secrets-cm.yaml
    kubernetesProvider:
      objects:
      - apiVersion: v1
        kind: Secret
        metadata:
          name: kc-secrets
          namespace: federatednode
        data:
          KEYCLOAK_ADMIN_PASSWORD: dGVzdA==
          KEYCLOAK_GLOBAL_CLIENT_SECRET: dGVzdA==
    asserts:
      - failedTemplate:
          errorMessage: Secret github-app not found in namespace federatednode

  - it: as a standalone, missing kc-secrets causes a failure
    template: copy-secrets-cm.yaml
    kubernetesProvider:
      objects:
      - apiVersion: v1
        kind: Secret
        metadata:
          name: github-app
          namespace: federatednode
        type: Opaque
        data:
          GH_SECRET: dGVzdA==
          GH_CLIENT_ID: dGVzdA==
    set:
      global:
    asserts:
      - failedTemplate:
          errorMessage: Secret kc-secrets not found in namespace federatednode

